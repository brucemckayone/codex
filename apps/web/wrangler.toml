name = "codex-web"
main = ".svelte-kit/cloudflare/_worker.js"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Static assets binding for SvelteKit
[assets]
binding = "ASSETS"
directory = ".svelte-kit/cloudflare"

# Observability configuration
[observability]
enabled = true

# Production environment
[env.production]
name = "codex-web-production"

[env.production.vars]
ENVIRONMENT = "production"
AUTH_WORKER_URL = "https://auth.revelations.studio"
API_URL = "https://api.revelations.studio"

# Wildcard route to handle all tenant subdomains (codex.revelations.studio, future-tenant.revelations.studio, etc.)
# Excludes api.* and auth.* which are handled by separate workers
[[env.production.routes]]
pattern = "*.revelations.studio/*"
custom_domain = true

# Staging environment
[env.staging]
name = "codex-web-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
AUTH_WORKER_URL = "https://auth-staging.revelations.studio"
API_URL = "https://api-staging.revelations.studio"

[[env.staging.routes]]
pattern = "*-staging.revelations.studio/*"
custom_domain = true

# Note: Secrets to be set via wrangler CLI or CI/CD:
# - DATABASE_URL
# - SESSION_SECRET
# - PUBLIC_APP_URL (for OAuth callbacks, etc.)
#
# Set secrets with:
#   wrangler secret put DATABASE_URL --env production
#   wrangler secret put SESSION_SECRET --env production
#
# For preview deployments, environment-specific configs will be created dynamically:
#   [env.preview-{PR_NUMBER}]
#   name = "codex-web-preview-{PR_NUMBER}"
