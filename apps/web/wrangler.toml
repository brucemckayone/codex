name = "codex-web"
main = ".svelte-kit/cloudflare/_worker.js"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Static assets binding for SvelteKit
[assets]
binding = "ASSETS"
directory = ".svelte-kit/cloudflare"

# Observability configuration
[observability]
enabled = true

# ============================================================================
# Production environment
# ============================================================================
[env.production]
name = "codex-web-production"

[env.production.vars]
ENVIRONMENT = "production"
AUTH_WORKER_URL = "https://auth.revelations.studio"
API_URL = "https://api.revelations.studio"
ORG_API_URL = "https://organization-api.revelations.studio"
ECOM_API_URL = "https://ecom-api.revelations.studio"

# Worker Routes for wildcard subdomain support
[[env.production.routes]]
pattern = "*.revelations.studio/*"
zone_name = "revelations.studio"

[[env.production.routes]]
pattern = "revelations.studio/*"
zone_name = "revelations.studio"

# ============================================================================
# Staging environment
# ============================================================================
[env.staging]
name = "codex-web-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
AUTH_WORKER_URL = "https://auth-staging.revelations.studio"
API_URL = "https://api-staging.revelations.studio"
ORG_API_URL = "https://organization-api-staging.revelations.studio"
ECOM_API_URL = "https://ecom-api-staging.revelations.studio"

[[env.staging.routes]]
pattern = "*-staging.revelations.studio/*"
zone_name = "revelations.studio"

# ============================================================================
# KV Namespaces (Placeholder IDs - provision and update)
# ============================================================================
# [[kv_namespaces]]
# binding = "BRAND_KV"
# id = "YOUR_KV_ID_HERE"
# preview_id = "YOUR_PREVIEW_KV_ID_HERE"

# ============================================================================
# Secrets (set via wrangler CLI or CI/CD):
# - wrangler secret put DATABASE_URL --env production
# - wrangler secret put SESSION_SECRET --env production
# ============================================================================
