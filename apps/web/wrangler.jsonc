{
  "$schema": "../../node_modules/wrangler/config-schema.json",
  "name": "codex-web",
  "main": ".svelte-kit/cloudflare/_worker.js",
  "compatibility_date": "2025-01-01",
  "compatibility_flags": ["nodejs_compat"],

  // Static assets binding for SvelteKit
  "assets": {
    "binding": "ASSETS",
    "directory": ".svelte-kit/cloudflare"
  },

  // Observability configuration
  "observability": {
    "enabled": true
  },

  // KV Namespaces
  "kv_namespaces": [
    {
      "binding": "BRAND_KV",
      "id": "e86ed818ff4f4a54bfb801bb46c10788",
      "preview_id": "d65732c40d7143e38f5b8cf5323a2250"
    }
  ],

  // Environment configurations
  "env": {
    // Test environment (E2E tests)
    "test": {
      "name": "codex-web-test",
      "vars": {
        "ENVIRONMENT": "test",
        "AUTH_WORKER_URL": "http://localhost:42069",
        "API_URL": "http://localhost:4001",
        "CONTENT_API_URL": "http://localhost:4001",
        "ORG_API_URL": "http://localhost:42071",
        "ECOM_API_URL": "http://localhost:42072",
        "MEDIA_API_URL": "http://localhost:8788",
        "IDENTITY_API_URL": "http://localhost:42074",
        "ADMIN_API_URL": "http://localhost:42073",
        "NOTIFICATIONS_API_URL": "http://localhost:42075"
      },
      "kv_namespaces": [
        {
          "binding": "BRAND_KV",
          "id": "e86ed818ff4f4a54bfb801bb46c10788"
        }
      ]
    },

    // Production environment
    "production": {
      "name": "codex-web-production",
      "vars": {
        "ENVIRONMENT": "production",
        "AUTH_WORKER_URL": "https://auth.revelations.studio",
        "API_URL": "https://content-api.revelations.studio",
        "CONTENT_API_URL": "https://content-api.revelations.studio",
        "ORG_API_URL": "https://organization-api.revelations.studio",
        "ECOM_API_URL": "https://ecom-api.revelations.studio",
        "MEDIA_API_URL": "https://media-api.revelations.studio",
        "IDENTITY_API_URL": "https://identity-api.revelations.studio",
        "ADMIN_API_URL": "https://admin-api.revelations.studio",
        "NOTIFICATIONS_API_URL": "https://notifications-api.revelations.studio"
      },
      "routes": [
        // Specific routes first (for priority)
        {
          "pattern": "revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        {
          "pattern": "www.revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        {
          "pattern": "codex.revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        {
          "pattern": "creators.revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        // Wildcard for organization subdomains (LAST - catches org slugs)
        // Note: API worker subdomains (auth, content-api, ecom-api, etc.) are
        // registered separately with custom_domain: true and take precedence
        {
          "pattern": "*.revelations.studio/*",
          "zone_name": "revelations.studio"
        }
      ]
    },

    // Staging environment
    "staging": {
      "name": "codex-web-staging",
      "vars": {
        "ENVIRONMENT": "staging",
        "AUTH_WORKER_URL": "https://auth-staging.revelations.studio",
        "API_URL": "https://content-api-staging.revelations.studio",
        "CONTENT_API_URL": "https://content-api-staging.revelations.studio",
        "ORG_API_URL": "https://organization-api-staging.revelations.studio",
        "ECOM_API_URL": "https://ecom-api-staging.revelations.studio",
        "MEDIA_API_URL": "https://media-api-staging.revelations.studio",
        "IDENTITY_API_URL": "https://identity-api-staging.revelations.studio",
        "ADMIN_API_URL": "https://admin-api-staging.revelations.studio",
        "NOTIFICATIONS_API_URL": "https://notifications-api-staging.revelations.studio"
      },
      "routes": [
        // Specific routes first (for priority)
        {
          "pattern": "codex-staging.revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        {
          "pattern": "creators-staging.revelations.studio/*",
          "zone_name": "revelations.studio"
        },
        // Wildcard for organization subdomains (LAST)
        // Note: Staging API workers use {service}-staging.revelations.studio pattern
        // and are registered separately with custom_domain: true
        {
          "pattern": "*-staging.revelations.studio/*",
          "zone_name": "revelations.studio"
        }
      ]
    }
    // Note: Preview configs are generated dynamically
  }

  // Note: Secrets to be set via wrangler CLI or CI/CD:
  // - DATABASE_URL
  // - SESSION_SECRET
  // - PUBLIC_APP_URL
}
