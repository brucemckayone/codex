name = "auth-worker"
main = "dist/index.js"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Observability configuration
[observability]
enabled = true

kv_namespaces = [
  { binding = "AUTH_SESSION_KV", id = "82d04a4236df4aac8e9d87793344f0ed" },
  { binding = "RATE_LIMIT_KV", id = "cea7153364974737b16870df08f31083" }
]

# Production environment
[env.production]
name = "auth-worker-production"

[env.production.vars]
ENVIRONMENT = "production"
WEB_APP_URL = "https://codex.revelations.studio"
API_URL = "https://api.revelations.studio"

[[env.production.routes]]
pattern = "auth.revelations.studio"
custom_domain = true

# Staging environment
[env.staging]
name = "auth-worker-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
WEB_APP_URL = "https://codex-staging.revelations.studio"
API_URL = "https://api-staging.revelations.studio"

[[env.staging.routes]]
pattern = "auth-staging.revelations.studio/*"
custom_domain = true

# Note: Secrets to be set via wrangler CLI or CI/CD:
# - DATABASE_URL
# - SESSION_SECRET
# - BETTER_AUTH_SECRET
#
# Set secrets with:
#   wrangler secret put DATABASE_URL --env production
#   wrangler secret put SESSION_SECRET --env production
#   wrangler secret put BETTER_AUTH_SECRET --env production
