name = "stripe-webhook-handler"
main = "dist/index.js"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Observability configuration
[observability]
enabled = true

# KV Namespaces
kv_namespaces = [
  { binding = "RATE_LIMIT_KV", id = "cea7153364974737b16870df08f31083" }
]

# Production environment
[env.production]
name = "stripe-webhook-handler-production"

[env.production.vars]
ENVIRONMENT = "production"
WEB_APP_URL = "https://codex.revelations.studio"
AUTH_WORKER_URL = "https://auth.revelations.studio"

[[env.production.routes]]
pattern = "api.revelations.studio/webhooks/stripe/*"
custom_domain = true

[[env.production.routes]]
pattern = "api.revelations.studio/health"
custom_domain = true

# Staging environment
[env.staging]
name = "stripe-webhook-handler-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
WEB_APP_URL = "https://codex-staging.revelations.studio"
AUTH_WORKER_URL = "https://auth-staging.revelations.studio"

[[env.staging.routes]]
pattern = "api-staging.revelations.studio/webhooks/stripe/*"
custom_domain = true

[[env.staging.routes]]
pattern = "api-staging.revelations.studio/health"
custom_domain = true

# Note: Secrets to be set via wrangler CLI or CI/CD:
# - DATABASE_URL
# - STRIPE_SECRET_KEY
# - STRIPE_WEBHOOK_SECRET
#
# Set secrets with:
#   wrangler secret put DATABASE_URL --env production
#   wrangler secret put STRIPE_SECRET_KEY --env production
#   wrangler secret put STRIPE_WEBHOOK_SECRET --env production
