# ============================================================================
# Codex Platform - Environment Variables Template
# ============================================================================
#
# Copy this file to .env and fill in your actual values.
# NEVER commit the .env file to git (it's in .gitignore).
#
# For complete setup instructions, see SETUP_SECRETS.md
#
# ============================================================================

# ============================================================================
# Database Configuration
# ============================================================================

# PostgreSQL connection string
# For local development: Use Docker Compose (see docker-compose.yml)
# For Cloudflare Workers: Use Neon with -pooler suffix
# Format: postgresql://user:password@host:port/database?sslmode=require

DATABASE_URL=postgresql://user:password@localhost:5432/codex

# Database client method (used in development)
# Options: "PRODUCTION" (Neon HTTP), "POOLER" (Neon WebSocket), "LOCAL" (TCP)
DB_METHOD=LOCAL

# ============================================================================
# Neon Configuration (for CI/CD and branching)
# ============================================================================

# Neon API key (auto-set by GitHub integration in CI)
# Get from: https://console.neon.tech/app/settings/api-keys
NEON_API_KEY=your_neon_api_key_here

# Neon project ID (auto-set by GitHub integration in CI)
# Get from: https://console.neon.tech (URL after /app/projects/)
NEON_PROJECT_ID=your_neon_project_id_here

# Parent branch for ephemeral branches (usually 'main' or 'production')
NEON_PARENT_BRANCH_ID=main

# ============================================================================
# Authentication & Security
# ============================================================================

# Session secret for cookie signing
# Generate with: openssl rand -base64 32
SESSION_SECRET=GENERATE_WITH_OPENSSL_RAND_BASE64_32

# Better Auth secret for JWT signing
# Generate with: openssl rand -base64 32
BETTER_AUTH_SECRET=GENERATE_WITH_OPENSSL_RAND_BASE64_32

# ============================================================================
# Stripe Configuration (Test Mode)
# ============================================================================

# Stripe secret key (test mode)
# Get from: https://dashboard.stripe.com/test/apikeys
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxx

# Stripe webhook secrets (test mode)
# Get from: https://dashboard.stripe.com/test/webhooks
# Each webhook endpoint has its own signing secret

STRIPE_WEBHOOK_SECRET_PAYMENT=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET_SUBSCRIPTION=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET_CONNECT=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET_CUSTOMER=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET_BOOKING=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET_DISPUTE=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ============================================================================
# Application URLs (Development)
# ============================================================================

# Base URL for the web application
WEB_APP_URL=http://localhost:8787

# Base URL for the API workers
API_URL=http://localhost:8789

# Auth worker URL
AUTH_URL=http://localhost:8788

# Content API URL
CONTENT_API_URL=http://localhost:4001

# Identity API URL
IDENTITY_API_URL=http://localhost:4002

# ============================================================================
# Environment
# ============================================================================

# Current environment (development, staging, production)
ENVIRONMENT=development

# Node environment (affects logging, error messages, etc.)
NODE_ENV=development

# ============================================================================
# Cloudflare Configuration (for wrangler commands)
# ============================================================================

# Cloudflare account ID
# Get from: https://dash.cloudflare.com → Select domain → Account ID (right column)
CLOUDFLARE_ACCOUNT_ID=your_cloudflare_account_id_here

# Cloudflare API token (for wrangler deployments)
# Get from: https://dash.cloudflare.com/profile/api-tokens
# Required permissions: Workers Scripts Edit, Workers KV Storage Edit
CLOUDFLARE_API_TOKEN=your_cloudflare_api_token_here

# ============================================================================
# Cloudflare R2 Storage Configuration
# ============================================================================

# R2 account ID (usually same as CLOUDFLARE_ACCOUNT_ID)
# Get from: https://dash.cloudflare.com → R2 → Overview
R2_ACCOUNT_ID=your_r2_account_id_here

# R2 API credentials for presigned URL generation
# Get from: https://dash.cloudflare.com → R2 → Manage R2 API Tokens
# Create token with "Admin Read & Write" permissions
R2_ACCESS_KEY_ID=your_r2_access_key_id_here
R2_SECRET_ACCESS_KEY=your_r2_secret_access_key_here

# R2 bucket names for different content types
# Development environment uses test buckets
R2_BUCKET_MEDIA=codex-media-test
R2_BUCKET_ASSETS=codex-assets-test
R2_BUCKET_RESOURCES=codex-resources-test
R2_BUCKET_PLATFORM=codex-platform-test

# Note: In production, bucket names will be:
# - codex-media-production
# - codex-assets-production
# - codex-resources-production
# - codex-platform-production

# ============================================================================
# Turborepo Remote Caching (Optional)
# ============================================================================

# Vercel token for remote caching
# Get from: https://vercel.com/account/tokens
# TURBO_TOKEN=your_vercel_token_here

# Vercel team slug
# TURBO_TEAM=your-team-slug

# ============================================================================
# Testing Configuration
# ============================================================================

# Used by CI to determine which tests to run
CI=false

# Playwright configuration
# Browser executables path (set automatically in CI)
# PLAYWRIGHT_BROWSERS_PATH=/path/to/browsers

# ============================================================================
# Development Tools
# ============================================================================

# Drizzle Studio port (optional)
# Default: 4983
# DRIZZLE_STUDIO_PORT=4983

# Enable debug logging (optional)
# DEBUG=true

# ============================================================================
# Port Configuration (Local Development)
# ============================================================================

# These ports are used by the respective services in development
# Configured in package.json scripts

# Web App:             http://localhost:8787
# Auth Worker:         http://localhost:8788
# Stripe Worker:       http://localhost:8789
# Content API:         http://localhost:4001
# Identity API:        http://localhost:4002
# PostgreSQL (Docker): postgresql://localhost:5432/codex

# ============================================================================
# KV Namespace IDs (for wrangler.jsonc)
# ============================================================================

# These are configured in wrangler.jsonc files, not .env
# Create with: wrangler kv:namespace create "NAMESPACE_NAME"
# See SETUP_SECRETS.md for detailed instructions

# ============================================================================
# Notes
# ============================================================================

# 1. Local Development:
#    - Use Docker Compose: pnpm docker:up
#    - DATABASE_URL should point to localhost
#    - Use Stripe test mode keys
#    - DB_METHOD should be "LOCAL"

# 2. Production (Cloudflare Workers):
#    - All secrets set via `wrangler secret put`
#    - DATABASE_URL should use Neon with -pooler suffix
#    - Use Stripe live mode keys
#    - DB_METHOD should be "PRODUCTION"

# 3. Testing (CI):
#    - Ephemeral Neon branches created automatically
#    - DATABASE_URL provided by workflow
#    - Use Stripe test mode keys
#    - NEON_API_KEY and NEON_PROJECT_ID auto-set by GitHub integration

# 4. Security:
#    - NEVER commit this file with real values
#    - Rotate secrets regularly (every 90-180 days)
#    - Use different secrets for each environment
#    - Store production secrets in GitHub Secrets and Cloudflare Workers

# ============================================================================
# Quick Start
# ============================================================================

# 1. Copy this file: cp .env.example .env
# 2. Generate secrets: openssl rand -base64 32
# 3. Fill in your values (at minimum: DATABASE_URL, SESSION_SECRET, BETTER_AUTH_SECRET)
# 4. Start Docker: pnpm docker:up
# 5. Run migrations: pnpm --filter @codex/database db:migrate
# 6. Start dev servers: pnpm dev

# For complete setup, see:
# - SETUP_SECRETS.md (comprehensive secret configuration)
# - design/infrastructure/EnvironmentManagement.md (environment strategies)
# - design/infrastructure/CICD.md (CI/CD workflows)
# - design/infrastructure/CLOUDFLARE-SETUP.md (Cloudflare configuration)
